var Webropol=Webropol||{};Webropol.Hierarchy=Webropol.Hierarchy||{};Webropol.Hierarchy.Common=function(n,t,i){function u(n,t){return n==null?!1:(t=$.trim(t),t.length===0)?!0:n.toLowerCase().indexOf(t.toLowerCase())>=0}function f(n){return ko.utils.arrayFirst(r,function(t){return t.RowId()===n})}function e(n){function t(n){u[n]=!0}function e(n){return u[n]}function s(n){for(var o=[],i=n,u,r;i&&i.ParentId()&&!e(i.ParentId());)u=i.ParentId(),t(u),r=f(u),r!=null&&o.unshift(r),i=r;return o}function o(n){var i=[];return ko.utils.arrayForEach(r,function(r){var u=r.RowId(),f;r.ParentId()!==n.RowId()||e(u)||(i.push(r),t(u),f=o(r),i=i.concat(f))}),i}var u=[],i=[];return ko.utils.arrayForEach(n,function(n){t(n.RowId());var r=s(n),u=o(n);i=i.concat(r,[n],u)}),i}var o=this,r=i.HierarchyGrid.Items().slice();this.resetSearch=function(){i.HierarchyGrid.Items(r.slice())};this.clientSearch=function(){var n=i.SelectedSearchMode(),f=i.SearchText(),s=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(n),o,t;i.HierarchyGrid.Items.removeAll();o=ko.utils.arrayFilter(r,function(t){return s?t.NodeTypeId()==n&&u(t.LevelName(),f):u(t[n](),f)});t=e(o);ko.utils.arrayForEach(t,function(n){n.Expanded(!0)});i.HierarchyGrid.Items(t)};this.resetSearchPanel=function(){i.SelectedSearchMode(null);i.SearchText("")}}